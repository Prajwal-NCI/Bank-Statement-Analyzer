<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bank Statement Analyzer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
    (function enforceLogin() {
        // If the userEmail or accessToken is missing then it will forcefully redirect to login
        const accessToken = localStorage.getItem('accessToken');
        const userEmail   = localStorage.getItem('userEmail');

        if (!accessToken || !userEmail) {
            // This will clear if anything is half saved
            localStorage.removeItem('accessToken');
            localStorage.removeItem('idToken');
            localStorage.removeItem('refreshToken');
            localStorage.removeItem('userEmail');

            // this part will redirect to login
            window.location.href = 'login.html';
        }
    })();
    </script>

    <link rel="stylesheet" href="css/index.css">
</head>
<body>

<div class="header">
    <h1>Bank Statement Analyzer</h1>
    <div class="user-section">
        <span class="user-email" id="userDisplay"></span>
        <span class="session-timer" id="sessionTimer"></span>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
</div>

<div class="container">
    <h1>Analyze your spending</h1>
    <p class="subtitle">Upload your bank statement PDF to see detailed totals and VAT estimates.</p>

    <div class="step-indicator">
        <span class="step active">1. Upload PDF</span>
        <span class="step">2. Review overview and details</span>
        <span class="step">3. (Optional) Save or delete</span>
    </div>

    <div class="input-group">
        <label>Upload bank statement (PDF)</label>
        <input type="file" id="fileInput" accept=".pdf"/>
    </div>

    <div class="input-group">
        <label for="countrySelect">Country (for VAT calculation)</label>
        <select id="countrySelect">
            <option value="IE">Ireland (23% VAT)</option>
            <option value="UK">United Kingdom (20% VAT)</option>
            <option value="DE">Germany (19% VAT)</option>
            <option value="FR">France (20% VAT)</option>
            <option value="ES">Spain (21% VAT)</option>
            <option value="IT">Italy (22% VAT)</option>
        </select>
    </div>

    <button class="btn" id="analyzeBtn">Upload and analyze</button>

    <div class="status" id="status"></div>

    <div class="result-box" id="resultBox">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('overview', this)">Overview</button>
            <button class="tab" onclick="switchTab('monthly', this)">Monthly</button>
            <button class="tab" onclick="switchTab('category', this)">Categories</button>
            <button class="tab" onclick="switchTab('saved', this)">My analyses</button>
            <button class="tab" onclick="switchTab('settings', this)">Settings</button>
        </div>

        <div id="overview" class="tab-content active">
            <p class="placeholder">
                No analysis yet. Upload a statement above to see your summary here.
            </p>
        </div>

        <div id="monthly" class="tab-content">
            <p class="placeholder">
                Monthly breakdown will appear after you run an analysis.
            </p>
        </div>

        <div id="category" class="tab-content">
            <p class="placeholder">
                Category breakdown will appear after you run an analysis.
            </p>
        </div>

        <div id="saved" class="tab-content">
            <h2>My saved analyses</h2>
            <div id="savedAnalysesList">
                <p class="placeholder">No saved analyses yet. Save an analysis from the Overview tab.</p>
            </div>
            <div class="status" id="savedStatus"></div>
        </div>

        <div id="settings" class="tab-content">
            <h2>Settings</h2>

            <div class="settings-section">
                <h3>Change email</h3>
                <p class="settings-note">Update the email address used for login and notifications.</p>
                <label for="newEmail">New email</label>
                <input type="email" class="form-control" id="newEmail" placeholder="new.email@example.com" />
                <button class="btn btn-primary" onclick="changeEmail()">Update email</button>
                <div class="status" id="emailStatus"></div>
            </div>

            <div class="settings-section">
                <h3>Change password</h3>
                <p class="settings-note">Update your password (minimum 8 characters).</p>
                <label for="oldPassword">Current password</label>
                <input type="password" class="form-control" id="oldPassword" placeholder="Enter current password" />
                <label for="newPassword">New password</label>
                <input type="password" class="form-control" id="newPassword" placeholder="Enter new password" />
                <label for="confirmPassword">Confirm new password</label>
                <input type="password" class="form-control" id="confirmPassword" placeholder="Re-enter new password" />
                <button class="btn btn-primary" onclick="changePassword()">Change password</button>
                <div class="status" id="passwordStatus"></div>
            </div>
        </div>
    </div>

    <div class="delete-section" id="deleteSection">
        <h3>File management</h3>
        <p><strong>Note:</strong> Your uploaded file is automatically deleted from our servers after 24 hours.</p>
        <p>If you want to delete it immediately, click the button below:</p>

        <button class="btn btn-danger" id="deleteBtn">Delete file now</button>
        <div class="status" id="deleteStatus"></div>
    </div>
</div>

<script src="js/index.js"></script>

</body>
</html>
